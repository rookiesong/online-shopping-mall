<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=0">

		<title>地址管理</title>

		<link href="/AmazeUI-2.4.2/assets/css/admin.css" rel="stylesheet" type="text/css">
		<link href="/AmazeUI-2.4.2/assets/css/amazeui.css" rel="stylesheet" type="text/css">

		<link href="/css/personal.css" rel="stylesheet" type="text/css">
		<link href="/css/addstyle.css" rel="stylesheet" type="text/css">
		<script src="/AmazeUI-2.4.2/assets/js/jquery.min.js" type="text/javascript"></script>
		<script src="/AmazeUI-2.4.2/assets/js/amazeui.js"></script>
	    <link rel="stylesheet" type="text/css" href="/layui/css/layui.css">
	    <script type="text/javascript" src="/layui/layui.js"></script>


	</head>

	<body>
	<!--顶部导航条 -->
	<div class="am-container header">
		<ul class="message-l">
			<div class="topMessage">
				<div class="menu-hd">
					<a th:href="@{'/customer/login'}" target="_top" class="h"><(*￣▽￣*)/登录</a>
					<a th:href="@{'/customer/register'}" target="_top">&nbsp;&nbsp;(=ˇωˇ=)注册</a>
				</div>
			</div>
		</ul>
		<ul class="message-r">
			<div class="topMessage mini-cart">
				<div class="menu-hd"><a id="mc-menu-hd" th:href="@{'/cart/shopping-cart'}" target="_top"><i class="am-icon-shopping-cart  am-icon-fw"></i><span>购物车</span><strong id="J_MiniCartNum" class="h"></strong></a></div>
			</div>
			<div class="topMessage favorite">
				<div class="menu-hd"><a href="#" target="_top"><i class="am-icon-heart am-icon-fw"></i><span>收藏夹</span></a></div>
		</ul>
	</div>

	<!--悬浮搜索框-->

	<div class="nav white">
		<div class="logoBig">
			<a th:href="@{/home}"><img src="/images/logobig.png"/></a>
		</div>

		<div class="search-bar pr">
			<form action="/product/search" method="post" >
				<input type="text"  name="productName" placeholder="请输入商品" autocomplete="off">
				<input id="ai-topsearch" class="submit am-btn" value="搜索" index="1" type="submit">
			</form>
		</div>
	</div>

						<div class="clear"></div>
					</div>
				</div>
			</article>
		</header>

		<div class="nav-table">
			<div class="long-title"><span class="all-goods">地址管理</span></div>
		</div>
		<b class="line"></b>

		<div class="center">
			<div class="col-main">
				<div class="main-wrap">

					<div class="user-address" >
						<!--标题 -->
						<div class="am-cf am-padding">
							<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">地址管理</strong> / <small>Address&nbsp;list</small></div>
						</div>
						<hr/>
						<ul class="am-avg-sm-1 am-avg-md-3 am-thumbnails"  >
							<li  class="user-addresslist" th:each="deliveryAddress:${deliveryAddresses}">
								<p class="new-tit new-p-re">
									<input style="border-style:none" class="new-txt" id="newname" th:value="${deliveryAddress.name}">
									<input style="border-style:none" class="new-txt-rd2" id="newphone" th:value="${deliveryAddress.userPhone}">
								</p>
								<div class="new-mu_l2a new-p-re">
									<p class="new-mu_l2cw">
										<textarea style="resize:none;overflow-x:hidden;overflow-y:hidden;width:100%;border: 0;" class="street" rows="4" id="newaddress" th:text="${deliveryAddress.address}"></textarea></p>
								</div>
								<div class="new-addr-btn" style="margin-top:-13px">
									<a class="changeaddress" th:itemid="${deliveryAddress.id}"><i class="am-icon-edit" ></i>更改</a>
									<span class="new-addr-bar">|</span>
									<a class="deleteaddress" th:itemId="${deliveryAddress.id}"><i class="am-icon-trash"></i>删除</a>
								</div>
							</li>
						</ul>
						<div class="clear"></div>
						<a class="new-abtn-type" data-am-modal="{target: '#doc-modal-1', closeViaDimmer: 0}">添加新地址</a>
						<!--例子-->
						<div class="am-modal am-modal-no-btn" id="doc-modal-1">

							<div class="add-dress">

								<!--标题 -->
								<div class="am-cf am-padding">
									<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">新增地址</strong> / <small>Add&nbsp;address</small></div>
								</div>
								<hr/>

								<div class="am-u-md-12 am-u-lg-8" style="margin-top: 20px;">
									<form class="am-form am-form-horizontal">

										<div class="am-form-group">
											<label for="user-name" class="am-form-label">收货人</label>
											<div class="am-form-content">
												<input type="text" id="user-name" placeholder="请输入收货人">
											</div>
										</div>

										<div class="am-form-group">
											<label for="user-phone" class="am-form-label">手机号码</label>
											<div class="am-form-content">
												<input id="user-phone" placeholder="请输入手机号码" type="email">
											</div>
										</div>
										<div class="am-form-group">
											<label for="user-intro" class="am-form-label">详细地址</label>
											<div class="am-form-content">
												<textarea class="" rows="3" id="user-intro" placeholder="请输入详细地址（100字以内）"></textarea>
											</div>
										</div>

										<div class="am-form-group">
											<div class="am-u-sm-9 am-u-sm-push-3">
												<a class="am-btn am-btn-danger">保存</a>
											</div>
										</div>
									</form>
								</div>

							</div>

						</div>

					</div>

					<script type="text/javascript">
						$(document).ready(function() {
							$(".new-option-r").click(function() {
								$(this).parent('.user-addresslist').addClass("defaultAddr").siblings().removeClass("defaultAddr");
							});

							var $ww = $(window).width();
							if($ww>640) {
								$("#doc-modal-1").removeClass("am-modal am-modal-no-btn")
							}

						})
					</script>

					<div class="clear"></div>

				</div>
				<!--底部-->
				<div class="footer ">
					<div class="footer-hd ">
						<p>
							<a href="# ">关于我们</a>
							<b>|</b>
							<a href="# ">帮助中心</a>
							<b>|</b>
							<a href="# ">售后服务</a>
						</p>
					</div>
					<div class="footer-bd ">
						<p>
							<em>IT企业实习Team14版权所有</em>
						</p>
					</div>
				</div>
			</div>

			<aside class="menu">
				<ul>
					<li class="person">
						<a href="#">个人中心</a>
					</li>
					<li class="person">
						<ul>
							<li> <a th:href="@{'/customer/center'}">个人资料</a></li>
							<li class="active"> <a th:href="@{'/delivery/addressPage'}">地址管理</a></li>
							<li> <a th:href="@{'/orders/showOrders'}">订单管理</a></li>
							<li> <a href="#">账户管理</a></li>
						</ul>
					</li>
				</ul>
			</aside>
		</div>
	<script type="text/javascript" th:inline="javascript">
		var deliveryAddresses=[[${deliveryAddresses}]];
		console.log(deliveryAddresses);
		/*修改地址*/
        layui.use('layer',function () {
            $(".changeaddress").click(function () {
                var address = $("#newaddress").val();
                var user_phone = $("#newphone").val();
                var name = $("#newname").val();
                var newid=$(this).attr("itemid");
                var id=parseInt(newid);
                var data={"id":id,"name": name, "address": address,"user_phone":user_phone};
                console.log(data);
                $.ajax({
                    url: "/delivery/editAddress",
                    type: "POST",
                    data: data,
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        if (data.status == "ok") {
                            layer.alert("修改成功！")
                        }
                        else {
                            layer.alert("修改失败！");
                        }

                    }
                });

            });
        });
        /*删除地址*/
        layui.use('layer',function () {
            $(".deleteaddress").click(function () {
                var newid=$(this).attr("itemId");
                var id=parseInt(newid);
                var data={"id": id};

                $.ajax({
                    url: "/delivery/deleteAddress",
                    type: "POST",
                    data: data,
                    dataType: "json",
                    async: false,
                    success: function (data) {
                        if (data.status == "ok") {
							window.location.href="/delivery/addressPage";
                        }
                    }
                });

            });
        });
        /*新增地址*/
        layui.use('layer',function () {
            $(".am-btn").click(function () {
                var name = $("#user-name").val();
                var address = $("#user-intro").val();
				var user_phone=$("#user-phone").val();
                var data={"name": name, "address": address,"user_phone":user_phone};
                console.log(data);
                if(name.length==0)
                    layer.alert("收货人不能为空！");
                else if(user_phone.length==0)
                    layer.alert("手机号码不能为空！");
                else if(user_phone.length!=11)
                    layer.alert("请输入合法的手机号码！");
                else if(address.length==0)
                    layer.alert("详细地址不能为空！");
                else if(address.length>100)
                    layer.alert("详细地址应在100字以内！");
                else {
                    $.ajax({
                        url: "/delivery/addAddress",
                        type: "POST",
                        data: data,
                        dataType: "json",
                        async: false,
                        success: function (data) {
                            if (data.status == "ok") {
                                layer.alert("新增地址成功！");
                                setTimeout(function () {
                                    window.location.href="/delivery/addressPage";
                                }, 1000);
                            }
                        }
                    });
                }
            });
        });
	</script>
	</body>

</html>